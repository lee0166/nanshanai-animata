# AIå½±è§†èµ„äº§ç”Ÿæˆå¹³å° - å°è¯´è§£æå®Œæ•´æµç¨‹æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **æ›´æ–°æ—¥æœŸ**: 2026-02-21  
> **é€‚ç”¨èŒƒå›´**: Nanshan AI Animata (å—å±± AI çŸ­å‰§ç‰ˆ)

---

## ä¸€ã€æµç¨‹æ¦‚è§ˆ

### 1.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ç”¨æˆ·äº¤äº’å±‚ (UI)                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   å‰§æœ¬ä¸Šä¼     â”‚  â”‚   è§£ææ§åˆ¶    â”‚  â”‚   ç»“æœå±•ç¤º    â”‚  â”‚   èµ„äº§æ˜ å°„    â”‚     â”‚
â”‚  â”‚  ScriptManagerâ”‚  â”‚  ä¸€é”®/åˆ†æ­¥è§£æ â”‚  â”‚  è§’è‰²/åœºæ™¯/åˆ†é•œâ”‚  â”‚  å…³è”ç°æœ‰èµ„äº§ â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                 â”‚                 â”‚
          â–¼                 â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æ ¸å¿ƒæœåŠ¡å±‚ (Services)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    ScriptParser (å‰§æœ¬è§£æå™¨)                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ å…ƒæ•°æ®æå– â”‚ â”‚ è§’è‰²åˆ†æ  â”‚ â”‚ åœºæ™¯åˆ†æ  â”‚ â”‚ é“å…·æå–  â”‚ â”‚ åˆ†é•œç”Ÿæˆ  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚Metadata  â”‚ â”‚Character â”‚ â”‚  Scene   â”‚ â”‚   Item   â”‚ â”‚   Shot   â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    LLMProvider (å¤§è¯­è¨€æ¨¡å‹æ¥å£)                       â”‚   â”‚
â”‚  â”‚         æ”¯æŒ: DeepSeek / Kimi / Qwen / GPT-4 ç­‰                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æ•°æ®å­˜å‚¨å±‚ (Storage)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   å‰§æœ¬æ•°æ®    â”‚  â”‚   è§£æçŠ¶æ€    â”‚  â”‚   è§’è‰²èµ„äº§    â”‚  â”‚   åœºæ™¯èµ„äº§    â”‚     â”‚
â”‚  â”‚   Script     â”‚  â”‚ ParseState   â”‚  â”‚  Character   â”‚  â”‚    Scene     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ä¸»æµç¨‹æ­¥éª¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤1   â”‚â”€â”€â”€â–¶â”‚ æ­¥éª¤2   â”‚â”€â”€â”€â–¶â”‚ æ­¥éª¤3   â”‚â”€â”€â”€â–¶â”‚ æ­¥éª¤4   â”‚â”€â”€â”€â–¶â”‚ æ­¥éª¤5   â”‚
â”‚ ä¸Šä¼ å‰§æœ¬ â”‚    â”‚ æå–å…ƒæ•°æ® â”‚    â”‚ åˆ†æè§’è‰²  â”‚    â”‚ åˆ†æåœºæ™¯  â”‚    â”‚ ç”Ÿæˆåˆ†é•œ  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚              â”‚              â”‚              â”‚              â”‚
     â–¼              â–¼              â–¼              â–¼              â–¼
  æ–‡ä»¶å¯¼å…¥      è·å–åŸºç¡€ä¿¡æ¯     è¯¦ç»†è§’è‰²è®¾å®š    è¯¦ç»†åœºæ™¯è®¾å®š    æ‹æ‘„è„šæœ¬
  æ–‡æœ¬è§£æ      æ ‡é¢˜/è§’è‰²/åœºæ™¯   å¤–è²Œ/æ€§æ ¼/å…³ç³»   ç¯å¢ƒ/æ°›å›´/åŠŸèƒ½   é•œå¤´/è¿é•œ/æ—¶é•¿
```

---

## äºŒã€è¯¦ç»†æµç¨‹è¯´æ˜

### 2.1 é˜¶æ®µä¸€ï¼šå‰§æœ¬ä¸Šä¼  (Script Upload)

#### 2.1.1 è§¦å‘å…¥å£
- **é¡µé¢**: `ScriptManager.tsx` - å‰§æœ¬ç®¡ç†é¡µé¢
- **æ“ä½œ**: ç‚¹å‡»"å¯¼å…¥å‰§æœ¬"æŒ‰é’®
- **æ–‡ä»¶æ”¯æŒ**: `.txt`, `.md`, `.docx`

#### 2.1.2 ç”¨æˆ·è¾“å…¥
| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| å‰§æœ¬æ ‡é¢˜ | string | æ˜¯ | ä½œå“åç§°ï¼Œå¯ä»æ–‡ä»¶åè‡ªåŠ¨æå– |
| å‰§æœ¬å†…å®¹ | text | æ˜¯ | å°è¯´/å‰§æœ¬æ­£æ–‡ |
| ä¸Šä¼ æ–‡ä»¶ | file | å¯é€‰ | æ”¯æŒ txt/md/docx |

#### 2.1.3 ç³»ç»Ÿå¤„ç†
```typescript
// æ ¸å¿ƒä»£ç : ScriptManager.tsx
const handleCreateScript = async () => {
  const newScript: Script = {
    id: `script_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
    projectId: effectiveProjectId,
    title: scriptTitle,
    content: scriptContent,
    parseState: {
      stage: 'idle',    // åˆå§‹çŠ¶æ€: æœªå¼€å§‹
      progress: 0
    },
    createdAt: Date.now(),
    updatedAt: Date.now()
  };
  
  await storageService.saveScript(newScript);
};
```

#### 2.1.4 æ•°æ®å­˜å‚¨ç»“æ„
```typescript
interface Script {
  id: string;                    // å”¯ä¸€æ ‡è¯†
  projectId: string;             // æ‰€å±é¡¹ç›®
  title: string;                 // æ ‡é¢˜
  content: string;               // åŸå§‹å†…å®¹
  parseState: ScriptParseState;  // è§£æçŠ¶æ€
  createdAt: number;
  updatedAt: number;
}
```

---

### 2.2 é˜¶æ®µäºŒï¼šå…ƒæ•°æ®æå– (Metadata Extraction)

#### 2.2.1 è§¦å‘æ¡ä»¶
- ç”¨æˆ·ç‚¹å‡»"ä¸€é”®è§£æ"æˆ–"1ï¸âƒ£ å…ƒæ•°æ®"æŒ‰é’®
- ç³»ç»Ÿè°ƒç”¨ `ScriptParser.extractMetadata()`

#### 2.2.2 ç³»ç»Ÿæç¤ºè¯ (System Prompt)
```typescript
const PROMPTS.metadata = `
è¯·å¿«é€Ÿåˆ†æä»¥ä¸‹å‰§æœ¬/å°è¯´å†…å®¹ï¼Œæå–åŸºç¡€å…ƒæ•°æ®ï¼š

ã€å‰§æœ¬å†…å®¹ã€‘
{content}

è¯·æå–ï¼š
1. ä½œå“æ ‡é¢˜
2. æ€»å­—æ•°
3. é¢„ä¼°æ—¶é•¿ï¼ˆå¦‚"10åˆ†é’Ÿ"ï¼‰
4. ä¸»è¦è§’è‰²æ•°é‡
5. ä¸»è¦è§’è‰²åç§°åˆ—è¡¨ï¼ˆä»…åç§°ï¼‰
6. ä¸»è¦åœºæ™¯æ•°é‡
7. ä¸»è¦åœºæ™¯åç§°åˆ—è¡¨ï¼ˆä»…åç§°ï¼‰
8. ç« èŠ‚/å¹•æ•°
9. æ•…äº‹ç±»å‹ï¼ˆå¤è£…/ç°ä»£/ç§‘å¹»/æ‚¬ç–‘ç­‰ï¼‰
10. æ•´ä½“åŸºè°ƒï¼ˆå–œå‰§/æ‚²å‰§/æ­£å‰§ï¼‰

è¯·ä¸¥æ ¼æŒ‰ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼Œä¸è¦æ·»åŠ ä»»ä½•å…¶ä»–å†…å®¹ï¼š
{
  "title": "ä½œå“æ ‡é¢˜",
  "wordCount": 15000,
  "estimatedDuration": "10åˆ†é’Ÿ",
  "characterCount": 8,
  "characterNames": ["è§’è‰²1", "è§’è‰²2"],
  "sceneCount": 12,
  "sceneNames": ["åœºæ™¯1", "åœºæ™¯2"],
  "chapterCount": 5,
  "genre": "å¤è£…å®…æ–—",
  "tone": "çˆ½å‰§"
}
`;
```

#### 2.2.3 è¾“å‡ºæ•°æ®ç»“æ„
```typescript
interface ScriptMetadata {
  title: string;                 // ä½œå“æ ‡é¢˜
  wordCount: number;             // æ€»å­—æ•°
  estimatedDuration: string;     // é¢„ä¼°æ—¶é•¿
  characterCount: number;        // è§’è‰²æ•°é‡
  characterNames: string[];      // è§’è‰²åç§°åˆ—è¡¨
  sceneCount: number;            // åœºæ™¯æ•°é‡
  sceneNames: string[];          // åœºæ™¯åç§°åˆ—è¡¨
  chapterCount: number;          // ç« èŠ‚æ•°
  genre: string;                 // æ•…äº‹ç±»å‹
  tone: string;                  // æ•´ä½“åŸºè°ƒ
}
```

---

### 2.3 é˜¶æ®µä¸‰ï¼šè§’è‰²åˆ†æ (Character Analysis)

#### 2.3.1 è§¦å‘æ¡ä»¶
- å…ƒæ•°æ®æå–å®Œæˆåè‡ªåŠ¨è¿›å…¥
- æˆ–ç”¨æˆ·ç‚¹å‡»"2ï¸âƒ£ è§’è‰²"æŒ‰é’®

#### 2.3.2 ç³»ç»Ÿæç¤ºè¯ (System Prompt)

**å•è§’è‰²åˆ†ææ¨¡å¼:**
```typescript
const PROMPTS.character = `
è¯·åŸºäºä»¥ä¸‹å‰§æœ¬å†…å®¹ï¼Œåˆ†æè§’è‰²"{characterName}"ã€‚

ã€å‰§æœ¬å†…å®¹ã€‘
{content}

è¯·æå–ä»¥ä¸‹ä¿¡æ¯ï¼Œä¸¥æ ¼æŒ‰JSONæ ¼å¼è¾“å‡ºï¼ˆç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½å­˜åœ¨ï¼‰ï¼š
{
  "name": "è§’è‰²å",
  "gender": "male/female/unknown",
  "age": "18",
  "identity": "èº«ä»½/èŒä¸š",
  "appearance": {
    "height": "èº«é«˜æè¿°",
    "build": "ä½“å‹",
    "face": "é¢å®¹ç‰¹å¾",
    "hair": "å‘å‹",
    "clothing": "æœé¥°é£æ ¼"
  },
  "personality": ["æ€§æ ¼1", "æ€§æ ¼2"],
  "signatureItems": ["æ ‡å¿—æ€§ç‰©å“1"],
  "emotionalArc": [
    {"phase": "åˆå§‹", "emotion": "æƒ…ç»ªçŠ¶æ€"}
  ],
  "relationships": [
    {"character": "ç›¸å…³è§’è‰²å", "relation": "å…³ç³»æè¿°"}
  ],
  "visualPrompt": "ä»…æè¿°å¤–è²Œç‰¹å¾ï¼šæ€§åˆ«ã€å¹´é¾„ã€é¢å®¹ã€å‘å‹ã€æœé¥°ã€ä½“å‹ã€æ ‡å¿—æ€§ç‰©å“ã€‚ç¦æ­¢ï¼šå‰§æƒ…ã€æƒ…ç»ªã€èƒŒæ™¯ã€å…³ç³»ã€‚æ ¼å¼ç¤ºä¾‹ï¼šå¤ä»£å°‘å¥³çº¦16å²ï¼Œç“œå­è„¸æŸ³å¶çœ‰ä¸¹å‡¤çœ¼ï¼Œä¹Œé»‘é•¿å‘æŒ½æˆå‚é¬Ÿåˆ†è‚–é«»ï¼Œèº«ç€æ·¡ç´«è‰²ç»£èŠ±è¥¦è£™å¤–æŠ«ç™½è‰²çº±è¡£ï¼Œä½“æ€çº¤ç»†ï¼Œæ‰‹æŒå›¢æ‰‡ã€‚80-120å­—"
}

é‡è¦æç¤ºï¼š
1. ageå­—æ®µå¿…é¡»æ˜¯çº¯æ•°å­—ï¼ˆå¦‚"18"ï¼‰ï¼Œä¸è¦å¸¦"å²"å­—
2. visualPromptå¿…é¡»çº¯å‡€ï¼šåªæè¿°å¤–è²Œå½¢è±¡ï¼Œç¦æ­¢åŒ…å«å‰§æƒ…ã€æƒ…ç»ªã€ç¯å¢ƒã€å…³ç³»
3. å¦‚æœä¿¡æ¯ä¸è¶³ï¼Œä½¿ç”¨åˆç†çš„é»˜è®¤å€¼å¡«å……æ‰€æœ‰å­—æ®µ
4. å¿…é¡»è¿”å›å®Œæ•´çš„JSONï¼Œä¸èƒ½çœç•¥ä»»ä½•å­—æ®µ
`;
```

**æ‰¹é‡è§’è‰²åˆ†ææ¨¡å¼ (ä¼˜åŒ–ç‰ˆ):**
```typescript
const PROMPTS.charactersBatch = `
è¯·åŸºäºä»¥ä¸‹å‰§æœ¬å†…å®¹ï¼Œä¸€æ¬¡æ€§åˆ†ææ‰€æœ‰è§’è‰²ã€‚

ã€å‰§æœ¬å†…å®¹ã€‘
{content}

ã€è§’è‰²åˆ—è¡¨ã€‘
{characterNames}

è¯·ä¸ºæ¯ä¸ªè§’è‰²æå–ä»¥ä¸‹ä¿¡æ¯ï¼Œä¸¥æ ¼æŒ‰JSONæ•°ç»„æ ¼å¼è¾“å‡ºï¼ˆç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½å­˜åœ¨ï¼‰ï¼š
[
  {
    "name": "è§’è‰²å",
    "gender": "male/female/unknown",
    "age": "18",
    "identity": "èº«ä»½/èŒä¸š",
    "appearance": {
      "height": "èº«é«˜æè¿°",
      "build": "ä½“å‹",
      "face": "é¢å®¹ç‰¹å¾",
      "hair": "å‘å‹",
      "clothing": "æœé¥°é£æ ¼"
    },
    "personality": ["æ€§æ ¼1", "æ€§æ ¼2"],
    "signatureItems": ["æ ‡å¿—æ€§ç‰©å“1"],
    "emotionalArc": [{"phase": "åˆå§‹", "emotion": "æƒ…ç»ªçŠ¶æ€"}],
    "relationships": [{"character": "ç›¸å…³è§’è‰²å", "relation": "å…³ç³»æè¿°"}],
    "visualPrompt": "ä»…æè¿°å¤–è²Œç‰¹å¾ï¼šæ€§åˆ«ã€å¹´é¾„ã€é¢å®¹ã€å‘å‹ã€æœé¥°ã€ä½“å‹ã€æ ‡å¿—æ€§ç‰©å“ã€‚ç¦æ­¢ï¼šå‰§æƒ…ã€æƒ…ç»ªã€èƒŒæ™¯ã€å…³ç³»ã€‚ç¤ºä¾‹ï¼šå¤ä»£å°‘å¥³çº¦16å²ï¼Œç“œå­è„¸æŸ³å¶çœ‰ï¼Œä¹Œé»‘é•¿å‘æŒ½é«»ï¼Œèº«ç€æ·¡ç´«è‰²ç»£èŠ±è¥¦è£™ï¼Œä½“æ€çº¤ç»†ï¼Œæ‰‹æŒå›¢æ‰‡ã€‚60-80å­—"
  }
]

é‡è¦æç¤ºï¼š
1. å¿…é¡»è¿”å›JSONæ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰è§’è‰²
2. ageå­—æ®µå¿…é¡»æ˜¯çº¯æ•°å­—
3. visualPromptå¿…é¡»çº¯å‡€ï¼šåªæè¿°å¤–è²Œå½¢è±¡ï¼Œç¦æ­¢åŒ…å«å‰§æƒ…ã€æƒ…ç»ªã€ç¯å¢ƒã€å…³ç³»
4. å¦‚æœä¿¡æ¯ä¸è¶³ï¼Œä½¿ç”¨åˆç†çš„é»˜è®¤å€¼
`;
```

#### 2.3.3 è¾“å‡ºæ•°æ®ç»“æ„
```typescript
interface ScriptCharacter {
  name: string;                  // è§’è‰²å
  gender?: 'male' | 'female' | 'unknown';
  age?: string;                  // å¹´é¾„ï¼ˆçº¯æ•°å­—ï¼‰
  identity?: string;             // èº«ä»½/èŒä¸š
  appearance: {
    height?: string;             // èº«é«˜
    build?: string;              // ä½“å‹
    face?: string;               // é¢å®¹
    hair?: string;               // å‘å‹
    clothing?: string;           // æœé¥°
  };
  personality: string[];         // æ€§æ ¼ç‰¹å¾
  signatureItems: string[];      // æ ‡å¿—æ€§ç‰©å“
  emotionalArc: Array<{         // æƒ…æ„Ÿå¼§çº¿
    phase: string;
    emotion: string;
  }>;
  relationships: Array<{        // äººç‰©å…³ç³»
    character: string;
    relation: string;
  }>;
  visualPrompt: string;          // AIç”Ÿå›¾æç¤ºè¯
  mappedAssetId?: string;        // å…³è”çš„èµ„äº§ID
}
```

#### 2.3.4 è§’è‰²æ˜ å°„æµç¨‹
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è§’è‰²æ˜ å°„æµç¨‹                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ è§£æå‡ºçš„è§’è‰² â”‚         â”‚ ç°æœ‰è§’è‰²èµ„äº§ â”‚                   â”‚
â”‚  â”‚ ScriptChar  â”‚         â”‚ CharacterAssetâ”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚         â”‚                       â”‚                          â”‚
â”‚         â–¼                       â–¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚        CharacterMapping.tsx          â”‚                  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                  â”‚
â”‚  â”‚  â”‚  1. æ˜¾ç¤ºè§£æè§’è‰²åˆ—è¡¨          â”‚   â”‚                  â”‚
â”‚  â”‚  â”‚  2. é€‰æ‹©å…³è”ç°æœ‰è§’è‰²          â”‚   â”‚                  â”‚
â”‚  â”‚  â”‚  3. æˆ–åˆ›å»ºæ–°è§’è‰²èµ„äº§          â”‚   â”‚                  â”‚
â”‚  â”‚  â”‚  4. æ‰¹é‡åˆ›å»ºæœªå…³è”è§’è‰²        â”‚   â”‚                  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                    â”‚                                        â”‚
â”‚                    â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  åˆ›å»ºè§’è‰²èµ„äº§æ—¶è‡ªåŠ¨å¡«å……:              â”‚                  â”‚
â”‚  â”‚  - name = scriptChar.name            â”‚                  â”‚
â”‚  â”‚  - prompt = scriptChar.visualPrompt  â”‚                  â”‚
â”‚  â”‚  - gender = scriptChar.gender        â”‚                  â”‚
â”‚  â”‚  - ageGroup = ä»ageè®¡ç®—å¾—å‡º          â”‚                  â”‚
â”‚  â”‚  - metadata = å®Œæ•´è§’è‰²ä¿¡æ¯           â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2.4 é˜¶æ®µå››ï¼šåœºæ™¯åˆ†æ (Scene Analysis)

#### 2.4.1 è§¦å‘æ¡ä»¶
- è§’è‰²åˆ†æå®Œæˆåè‡ªåŠ¨è¿›å…¥
- æˆ–ç”¨æˆ·ç‚¹å‡»"3ï¸âƒ£ åœºæ™¯"æŒ‰é’®

#### 2.4.2 ç³»ç»Ÿæç¤ºè¯ (System Prompt)

**å•åœºæ™¯åˆ†ææ¨¡å¼:**
```typescript
const PROMPTS.scene = `
è¯·åˆ†æä»¥ä¸‹å‰§æœ¬ä¸­çš„åœºæ™¯"{sceneName}"ã€‚

ã€å‰§æœ¬å†…å®¹ã€‘
{content}

è¯·æå–ä»¥ä¸‹ä¿¡æ¯ï¼Œä¸¥æ ¼æŒ‰JSONæ ¼å¼è¾“å‡ºï¼ˆç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½å­˜åœ¨ï¼‰ï¼š
{
  "name": "åœºæ™¯å",
  "locationType": "indoor/outdoor/unknown",
  "description": "åœºæ™¯æè¿°",
  "timeOfDay": "æ—¶é—´æ®µ",
  "season": "å­£èŠ‚",
  "weather": "å¤©æ°”",
  "environment": {
    "architecture": "å»ºç­‘é£æ ¼",
    "furnishings": ["é™ˆè®¾1"],
    "lighting": "å…‰çº¿æ¡ä»¶",
    "colorTone": "è‰²è°ƒæ°›å›´"
  },
  "sceneFunction": "åœºæ™¯åœ¨æ•…äº‹ä¸­çš„ä½œç”¨",
  "visualPrompt": "ç”¨äºAIç”Ÿå›¾çš„è¯¦ç»†è§†è§‰æè¿°ï¼Œ100å­—ä»¥å†…",
  "characters": ["åœºæ™¯ä¸­å‡ºç°çš„è§’è‰²å"]
}

é‡è¦æç¤ºï¼š
1. å¦‚æœä¿¡æ¯ä¸è¶³ï¼Œä½¿ç”¨åˆç†çš„é»˜è®¤å€¼å¡«å……æ‰€æœ‰å­—æ®µ
2. å¿…é¡»è¿”å›å®Œæ•´çš„JSONï¼Œä¸èƒ½çœç•¥ä»»ä½•å­—æ®µ
`;
```

**æ‰¹é‡åœºæ™¯åˆ†ææ¨¡å¼:**
```typescript
const PROMPTS.scenesBatch = `
è¯·åŸºäºä»¥ä¸‹å‰§æœ¬å†…å®¹ï¼Œä¸€æ¬¡æ€§åˆ†ææ‰€æœ‰åœºæ™¯ã€‚

ã€å‰§æœ¬å†…å®¹ã€‘
{content}

ã€åœºæ™¯åˆ—è¡¨ã€‘
{sceneNames}

è¯·ä¸ºæ¯ä¸ªåœºæ™¯æå–ä»¥ä¸‹ä¿¡æ¯ï¼Œä¸¥æ ¼æŒ‰JSONæ•°ç»„æ ¼å¼è¾“å‡ºï¼ˆç¡®ä¿æ‰€æœ‰å­—æ®µéƒ½å­˜åœ¨ï¼‰ï¼š
[
  {
    "name": "åœºæ™¯å",
    "locationType": "indoor/outdoor/unknown",
    "description": "åœºæ™¯æè¿°ï¼Œ30å­—ä»¥å†…",
    "timeOfDay": "æ—¶é—´æ®µ",
    "season": "å­£èŠ‚",
    "weather": "å¤©æ°”",
    "environment": {
      "architecture": "å»ºç­‘é£æ ¼",
      "furnishings": ["é™ˆè®¾1"],
      "lighting": "å…‰çº¿æ¡ä»¶",
      "colorTone": "è‰²è°ƒæ°›å›´"
    },
    "sceneFunction": "åœºæ™¯ä½œç”¨",
    "visualPrompt": "ç”¨äºAIç”Ÿå›¾çš„æè¿°ï¼Œ50å­—ä»¥å†…",
    "characters": ["åœºæ™¯ä¸­å‡ºç°çš„è§’è‰²å"]
  }
]

é‡è¦æç¤ºï¼š
1. å¿…é¡»è¿”å›JSONæ•°ç»„ï¼ŒåŒ…å«æ‰€æœ‰åœºæ™¯
2. descriptionå’ŒvisualPromptæ§åˆ¶åœ¨50å­—ä»¥å†…ï¼ŒèŠ‚çœtoken
3. å¦‚æœä¿¡æ¯ä¸è¶³ï¼Œä½¿ç”¨åˆç†çš„é»˜è®¤å€¼
`;
```

#### 2.4.3 è¾“å‡ºæ•°æ®ç»“æ„
```typescript
interface ScriptScene {
  name: string;                  // åœºæ™¯å
  locationType: 'indoor' | 'outdoor' | 'unknown';
  description: string;           // åœºæ™¯æè¿°
  timeOfDay?: string;            // æ—¶é—´æ®µ
  season?: string;               // å­£èŠ‚
  weather?: string;              // å¤©æ°”
  environment: {
    architecture?: string;       // å»ºç­‘é£æ ¼
    furnishings?: string[];      // é™ˆè®¾
    lighting?: string;           // å…‰çº¿
    colorTone?: string;          // è‰²è°ƒ
  };
  sceneFunction: string;         // åœºæ™¯åŠŸèƒ½
  visualPrompt: string;          // AIç”Ÿå›¾æç¤ºè¯
  characters: string[];          // æ¶‰åŠè§’è‰²
  mappedAssetId?: string;        // å…³è”çš„èµ„äº§ID
}
```

---

### 2.5 é˜¶æ®µäº”ï¼šé“å…·æå– (Item Extraction)

#### 2.5.1 è§¦å‘æ¡ä»¶
- åœºæ™¯åˆ†æå®Œæˆåè‡ªåŠ¨æå–
- åœ¨"é“å…·"æ ‡ç­¾é¡µæ˜¾ç¤ºç»“æœ

#### 2.5.2 ç³»ç»Ÿæç¤ºè¯ (System Prompt)
```typescript
const PROMPTS.itemsBatch = `
è¯·åŸºäºä»¥ä¸‹å‰§æœ¬å†…å®¹ï¼Œæå–æ‰€æœ‰é‡è¦é“å…·/ç‰©å“ã€‚

ã€å‰§æœ¬å†…å®¹ã€‘
{content}

è¯·æå–ä»¥ä¸‹ç±»å‹çš„é“å…·ï¼š
1. æ­¦å™¨ï¼ˆå‰‘ã€æªã€æ³•å™¨ç­‰ï¼‰
2. å·¥å…·ï¼ˆç‰¹æ®Šå·¥å…·ã€è®¾å¤‡ç­‰ï¼‰
3. ç å®é¥°å“ï¼ˆé¡¹é“¾ã€æˆ’æŒ‡ç­‰ï¼‰
4. æ–‡æ¡£ï¼ˆä¿¡ä»¶ã€åœ°å›¾ã€ç§˜ç±ç­‰ï¼‰
5. ç”Ÿç‰©/çµå…½ï¼ˆå® ç‰©ã€åéª‘ç­‰ï¼‰
6. å…¶ä»–é‡è¦ç‰©å“

è¯·ä¸¥æ ¼æŒ‰JSONæ•°ç»„æ ¼å¼è¾“å‡ºï¼š
[
  {
    "name": "é“å…·åç§°",
    "description": "é“å…·æè¿°ï¼Œ50å­—ä»¥å†…",
    "category": "weapon/tool/jewelry/document/creature/animal/other",
    "owner": "æ‰€å±è§’è‰²åï¼ˆå¦‚æœ‰ï¼‰",
    "importance": "major/minor",
    "visualPrompt": "ç”¨äºAIç”Ÿå›¾çš„æè¿°ï¼Œ50å­—ä»¥å†…"
  }
]

é‡è¦æç¤ºï¼š
1. åªæå–å¯¹å‰§æƒ…æœ‰é‡è¦ä½œç”¨çš„é“å…·
2. æ™®é€šç‰©å“ï¼ˆå¦‚æ¡Œæ¤…ã€è¡£æœï¼‰ä¸éœ€è¦æå–
3. å¿…é¡»è¿”å›JSONæ•°ç»„
`;
```

#### 2.5.3 è¾“å‡ºæ•°æ®ç»“æ„
```typescript
interface ScriptItem {
  name: string;                  // é“å…·åç§°
  description: string;           // æè¿°
  category: 'weapon' | 'tool' | 'jewelry' | 'document' | 'creature' | 'animal' | 'other';
  owner?: string;                // æ‰€å±è§’è‰²
  importance: 'major' | 'minor'; // é‡è¦ç¨‹åº¦
  visualPrompt: string;          // AIç”Ÿå›¾æç¤ºè¯
  mappedAssetId?: string;        // å…³è”çš„èµ„äº§ID
}
```

---

### 2.6 é˜¶æ®µå…­ï¼šåˆ†é•œç”Ÿæˆ (Shot Generation)

#### 2.6.1 è§¦å‘æ¡ä»¶
- åœºæ™¯åˆ†æå®Œæˆåè‡ªåŠ¨è¿›å…¥
- æˆ–ç”¨æˆ·ç‚¹å‡»"4ï¸âƒ£ åˆ†é•œ"æŒ‰é’®

#### 2.6.2 ç³»ç»Ÿæç¤ºè¯ (System Prompt)

**å•åœºæ™¯åˆ†é•œæ¨¡å¼:**
```typescript
const PROMPTS.shots = `
è¯·ä¸ºä»¥ä¸‹åœºæ™¯ç”Ÿæˆåˆ†é•œè„šæœ¬ã€‚

ã€åœºæ™¯ä¿¡æ¯ã€‘
åœºæ™¯åç§°: {sceneName}
åœºæ™¯æè¿°: {sceneDescription}
æ¶‰åŠè§’è‰²: {characters}

ã€å‰§æœ¬åŸæ–‡ã€‘
{content}

è¯·ç”Ÿæˆè¯¦ç»†åˆ†é•œï¼Œè¦æ±‚ï¼š
1. æ¯ä¸ªé•œå¤´åŒ…å«ï¼šåºå·ã€æ™¯åˆ«ã€è¿é•œæ–¹å¼ã€ç”»é¢æè¿°ã€å°è¯ã€éŸ³æ•ˆã€é¢„ä¼°æ—¶é•¿ã€æ¶‰åŠè§’è‰²
2. æ™¯åˆ«é€‰é¡¹ï¼šextreme_long(æè¿œæ™¯), long(è¿œæ™¯), full(å…¨æ™¯), medium(ä¸­æ™¯), close_up(è¿‘æ™¯), extreme_close_up(æè¿‘æ™¯)
3. è¿é•œé€‰é¡¹ï¼šstatic(å›ºå®š), push(æ¨), pull(æ‹‰), pan(æ‘‡), tilt(å‡é™), track(ç§»), crane(å‡é™)
4. æ¯ä¸ªåœºæ™¯ç”Ÿæˆ5-15ä¸ªé•œå¤´

è¯·ä¸¥æ ¼æŒ‰ä»¥ä¸‹JSONæ•°ç»„æ ¼å¼è¾“å‡ºï¼š
[
  {
    "sequence": 1,
    "shotType": "full",
    "cameraMovement": "static",
    "description": "ç”»é¢æè¿°",
    "dialogue": "å°è¯ï¼ˆå¯é€‰ï¼‰",
    "sound": "éŸ³æ•ˆï¼ˆå¯é€‰ï¼‰",
    "duration": 3,
    "characters": ["è§’è‰²å"]
  }
]
`;
```

**æ‰¹é‡åˆ†é•œç”Ÿæˆæ¨¡å¼:**
```typescript
const PROMPTS.shotsBatch = `
è¯·ä¸ºä»¥ä¸‹æ‰€æœ‰åœºæ™¯ç”Ÿæˆåˆ†é•œè„šæœ¬ã€‚

ã€å‰§æœ¬å†…å®¹ã€‘
{content}

ã€åœºæ™¯ä¿¡æ¯ã€‘
{scenesInfo}

è¯·ä¸ºæ¯ä¸ªåœºæ™¯ç”Ÿæˆ3-5ä¸ªå…³é”®åˆ†é•œï¼Œä¸¥æ ¼æŒ‰JSONæ•°ç»„æ ¼å¼è¾“å‡ºï¼š
[
  {
    "sceneName": "åœºæ™¯åç§°",
    "sequence": 1,
    "shotType": "full",
    "cameraMovement": "static",
    "description": "ç”»é¢æè¿°ï¼Œ30å­—ä»¥å†…",
    "dialogue": "å°è¯ï¼ˆå¯é€‰ï¼‰",
    "sound": "éŸ³æ•ˆï¼ˆå¯é€‰ï¼‰",
    "duration": 3,
    "characters": ["è§’è‰²å"]
  }
]

æ™¯åˆ«é€‰é¡¹ï¼šextreme_long, long, full, medium, close_up, extreme_close_up
è¿é•œé€‰é¡¹ï¼šstatic, push, pull, pan, tilt, track, crane

é‡è¦æç¤ºï¼š
1. æ¯ä¸ªåœºæ™¯ç”Ÿæˆ3-5ä¸ªå…³é”®åˆ†é•œ
2. descriptionæ§åˆ¶åœ¨30å­—ä»¥å†…ï¼ŒèŠ‚çœtoken
3. å¿…é¡»åŒ…å«sceneNameå­—æ®µç”¨äºåŒºåˆ†åœºæ™¯
`;
```

#### 2.6.3 è¾“å‡ºæ•°æ®ç»“æ„
```typescript
type ShotType = 'extreme_long' | 'long' | 'full' | 'medium' | 'close_up' | 'extreme_close_up';
type CameraMovement = 'static' | 'push' | 'pull' | 'pan' | 'tilt' | 'track' | 'crane';

interface Shot {
  id: string;                    // åˆ†é•œID
  sequence: number;              // åºå·
  sceneName: string;             // æ‰€å±åœºæ™¯
  shotType: ShotType;            // æ™¯åˆ«
  cameraMovement: CameraMovement;// è¿é•œ
  description: string;           // ç”»é¢æè¿°
  dialogue?: string;             // å°è¯
  sound?: string;                // éŸ³æ•ˆ
  duration: number;              // æ—¶é•¿(ç§’)
  characters: string[];          // æ¶‰åŠè§’è‰²
  mappedFragmentId?: string;     // å…³è”çš„ç‰‡æ®µID
  keyframes?: Keyframe[];        // å…³é”®å¸§åˆ—è¡¨
}

interface Keyframe {
  id: string;
  sequence: number;              // åœ¨åˆ†é•œå†…çš„åºå·
  description: string;           // é™æ€ç”»é¢æè¿°
  prompt: string;                // å›¾ç”Ÿå›¾æç¤ºè¯
  duration: number;              // è¯¥å…³é”®å¸§æ—¶é•¿
  references: {
    character?: { id: string; name: string };
    scene?: { id: string; name: string };
  };
  generatedImages?: GeneratedImage[];
  currentImageId?: string;
  status: 'pending' | 'generating' | 'completed' | 'failed';
}
```

---

## ä¸‰ã€è§£æçŠ¶æ€ç®¡ç†

### 3.1 çŠ¶æ€æµè½¬å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  idle   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚         â”‚ (æœªå¼€å§‹) â”‚         â”‚
         â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â”‚
         â”‚              â”‚              â”‚
         â”‚              â–¼              â”‚
         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
         â”‚    â”Œâ”€â”€â”€â–¶â”‚metadata â”‚         â”‚
         â”‚    â”‚    â”‚(å…ƒæ•°æ®) â”‚         â”‚
         â”‚    â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â”‚
         â”‚    â”‚         â”‚              â”‚
         â”‚    â”‚         â–¼              â”‚
         â”‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
         â”‚    â”‚    â”‚charactersâ”‚        â”‚
         â”‚    â”‚    â”‚(è§’è‰²åˆ†æ)â”‚        â”‚
         â”‚    â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â”‚
         â”‚    â”‚         â”‚              â”‚
         â”‚    â”‚         â–¼              â”‚
         â”‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
         â”‚    â”‚    â”‚  scenes â”‚         â”‚
         â”‚    â”‚    â”‚(åœºæ™¯åˆ†æ)â”‚         â”‚
         â”‚    â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â”‚
         â”‚    â”‚         â”‚              â”‚
         â”‚    â”‚         â–¼              â”‚
         â”‚    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
         â”‚    â””â”€â”€â”€â–¶â”‚  shots  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚         â”‚(åˆ†é•œç”Ÿæˆ)â”‚  é‡æ–°è§£æ
         â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚              â”‚
         â”‚              â–¼
         â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â””â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚completedâ”‚
                   â”‚(å·²å®Œæˆ) â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”Œâ”€â”€â”€â–¶â”‚  error  â”‚
              â”‚    â”‚(é”™è¯¯)   â”‚
              â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  é‡è¯•
```

### 3.2 çŠ¶æ€æ•°æ®ç»“æ„
```typescript
interface ScriptParseState {
  stage: ParseStage;             // å½“å‰é˜¶æ®µ
  progress: number;              // è¿›åº¦ 0-100
  metadata?: ScriptMetadata;     // å…ƒæ•°æ®
  characters?: ScriptCharacter[];// è§’è‰²åˆ—è¡¨
  scenes?: ScriptScene[];        // åœºæ™¯åˆ—è¡¨
  items?: ScriptItem[];          // é“å…·åˆ—è¡¨
  shots?: Shot[];                // åˆ†é•œåˆ—è¡¨
  error?: string;                // é”™è¯¯ä¿¡æ¯
  currentChunkIndex?: number;    // å½“å‰åˆ†å—ç´¢å¼•
  totalChunks?: number;          // æ€»åˆ†å—æ•°
}

type ParseStage = 
  | 'idle'       // æœªå¼€å§‹
  | 'metadata'   // æå–å…ƒæ•°æ®
  | 'characters' // åˆ†æè§’è‰²
  | 'scenes'     // åˆ†æåœºæ™¯
  | 'items'      // æå–é“å…·
  | 'shots'      // ç”Ÿæˆåˆ†é•œ
  | 'completed'  // å·²å®Œæˆ
  | 'error';     // å‡ºé”™
```

---

## å››ã€æŠ€æœ¯å®ç°ç»†èŠ‚

### 4.1 æ ¸å¿ƒç±»: ScriptParser

```typescript
export class ScriptParser {
  // é…ç½®å‚æ•°
  private config = {
    maxChunkSize: 6000,      // æœ€å¤§åˆ†å—å¤§å°
    defaultModel: 'gpt-4o-mini',
    maxRetries: 3,           // æœ€å¤§é‡è¯•æ¬¡æ•°
    retryDelay: 2000,        // é‡è¯•å»¶è¿Ÿ(ms)
    timeout: 60000,          // APIè¶…æ—¶(ms)
    concurrency: 1,          // å¹¶å‘æ•°(é˜²é™æµ)
    callDelay: 1000,         // è°ƒç”¨é—´éš”(ms)
  };

  // ä¸»è¦æ–¹æ³•
  async extractMetadata(content: string): Promise<ScriptMetadata>;
  async extractCharacter(content: string, characterName: string): Promise<ScriptCharacter>;
  async extractScene(content: string, sceneName: string): Promise<ScriptScene>;
  async generateShots(content: string, sceneName: string, ...): Promise<Shot[]>;
  
  // æ‰¹é‡æ–¹æ³•(ä¼˜åŒ–APIè°ƒç”¨)
  async extractAllCharacters(content: string, characterNames: string[]): Promise<ScriptCharacter[]>;
  async extractAllScenes(content: string, sceneNames: string[]): Promise<ScriptScene[]>;
  async generateAllShots(content: string, scenes: ScriptScene[]): Promise<Shot[]>;
  
  // ä¸»è§£ææµç¨‹
  async parseScript(scriptId: string, projectId: string, content: string, onProgress?: ParseProgressCallback): Promise<ScriptParseState>;
  async parseStage(stage: ParseStage, content: string, currentState: ScriptParseState, onProgress?: ParseProgressCallback): Promise<ScriptParseState>;
}
```

### 4.2 ç¼“å­˜æœºåˆ¶

```typescript
class ParseCache {
  private cache: Map<string, { result: any; timestamp: number }>;
  private maxSize: number = 100;    // æœ€å¤§ç¼“å­˜æ•°
  private ttl: number = 3600000;    // ç¼“å­˜æœ‰æ•ˆæœŸ1å°æ—¶

  get(content: string): any | null;
  set(content: string, result: any): void;
  clear(): void;
}
```

### 4.3 å¹¶å‘æ§åˆ¶

```typescript
class ConcurrencyLimiter {
  private concurrency: number = 1;  // å¹¶å‘é™åˆ¶ä¸º1(é˜²é™æµ)
  private running: number = 0;
  private queue: Array<() => void> = [];

  async run<T>(fn: () => Promise<T>): Promise<T>;
}
```

### 4.4 LLMè°ƒç”¨

```typescript
// LLMProvider.ts
async generateText(
  prompt: string,
  config: ModelConfig,
  systemPrompt?: string,
  extraParams?: Record<string, any>
): Promise<AIResult>;

// é»˜è®¤System Prompt
const DEFAULT_SYSTEM_PROMPT = 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å‰§æœ¬åˆ†æåŠ©æ‰‹ï¼Œæ“…é•¿ä»å°è¯´/å‰§æœ¬ä¸­æå–ç»“æ„åŒ–ä¿¡æ¯ã€‚è¯·ä¸¥æ ¼æŒ‰ç…§è¦æ±‚çš„JSONæ ¼å¼è¾“å‡ºã€‚';
```

---

## äº”ã€ç”¨æˆ·ç•Œé¢äº¤äº’

### 5.1 å‰§æœ¬ç®¡ç†é¡µé¢ (ScriptManager.tsx)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å‰§æœ¬ç®¡ç†                                          [å¯¼å…¥å‰§æœ¬]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è§£æçŠ¶æ€                                    [é€‰æ‹©æ¨¡å‹ â–¼] â”‚   â”‚
â”‚  â”‚ â— å·²å®Œæˆ                                        [é‡æ–°è§£æ] â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚ è¿›åº¦: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 85%                      â”‚   â”‚
â”‚  â”‚ æ­£åœ¨ç”Ÿæˆåˆ†é•œ: åœºæ™¯3 - å®«å»·å¤§æ®¿                              â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚ å¿«æ·åˆ†æ­¥è§£æ:                                              â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚ â”‚ 1ï¸âƒ£ å…ƒæ•°æ® â”‚ â”‚ 2ï¸âƒ£ è§’è‰²  â”‚ â”‚ 3ï¸âƒ£ åœºæ™¯  â”‚ â”‚ 4ï¸âƒ£ åˆ†é•œ  â”‚              â”‚   â”‚
â”‚  â”‚ â”‚  âœ“å®Œæˆ  â”‚ â”‚  âœ“å®Œæˆ  â”‚ â”‚  âœ“å®Œæˆ  â”‚ â”‚ è¿›è¡Œä¸­  â”‚              â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚                                                            â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
â”‚  â”‚ â”‚  12   â”‚   8    â”‚   36   â”‚  5åˆ†30ç§’â”‚                    â”‚   â”‚
â”‚  â”‚ â”‚  è§’è‰²  â”‚  åœºæ™¯  â”‚  åˆ†é•œ  â”‚ æ€»æ—¶é•¿  â”‚                    â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“„ åŸæ–‡ â”‚ ğŸ‘¥ è§’è‰²(12) â”‚ ğŸ“ åœºæ™¯(8) â”‚ ğŸ“¦ é“å…· â”‚ ğŸ¬ åˆ†é•œ(36) â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚ [è§’è‰²æ˜ å°„ç•Œé¢]                                            â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚
â”‚  â”‚ â”‚   æ—é»›ç‰    â”‚ â”‚   è´¾å®ç‰    â”‚ â”‚   è–›å®é’—    â”‚         â”‚   â”‚
â”‚  â”‚ â”‚   [å¤´åƒ]    â”‚ â”‚   [å¤´åƒ]    â”‚ â”‚   [å¤´åƒ]    â”‚         â”‚   â”‚
â”‚  â”‚ â”‚ å¥³ Â· 16å²   â”‚ â”‚ ç”· Â· 18å²   â”‚ â”‚ å¥³ Â· 18å²   â”‚         â”‚   â”‚
â”‚  â”‚ â”‚ âœ“ å·²å…³è”    â”‚ â”‚ âœ“ å·²å…³è”    â”‚ â”‚ â—‹ æœªå…³è”    â”‚         â”‚   â”‚
â”‚  â”‚ â”‚ [å…³è”è§’è‰²â–¼] â”‚ â”‚ [å…³è”è§’è‰²â–¼] â”‚ â”‚ [åˆ›å»ºè§’è‰²]  â”‚         â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 è§£æè¿›åº¦å›è°ƒ

```typescript
type ParseProgressCallback = (
  stage: ParseStage,      // å½“å‰é˜¶æ®µ
  progress: number,       // è¿›åº¦ 0-100
  message?: string        // çŠ¶æ€æè¿°
) => void;

// ä½¿ç”¨ç¤ºä¾‹
const onProgress: ParseProgressCallback = (stage, progress, message) => {
  console.log(`${stage}: ${progress}% - ${message}`);
  // æ›´æ–°UIè¿›åº¦æ¡
};
```

---

## å…­ã€é”™è¯¯å¤„ç†ä¸æ¢å¤

### 6.1 é”™è¯¯ç±»å‹

| é”™è¯¯ç±»å‹ | è¯´æ˜ | å¤„ç†ç­–ç•¥ |
|---------|------|---------|
| APIé”™è¯¯ | LLMæ¥å£è°ƒç”¨å¤±è´¥ | æŒ‡æ•°é€€é¿é‡è¯•(æœ€å¤š3æ¬¡) |
| ç½‘ç»œé”™è¯¯ | è¿æ¥ä¸­æ–­ | è‡ªåŠ¨é‡è¯•ï¼Œè¶…æ—¶åæŠ¥é”™ |
| è§£æé”™è¯¯ | JSONè§£æå¤±è´¥ | å°è¯•ä¿®å¤å¸¸è§æ ¼å¼é—®é¢˜ |
| é™æµé”™è¯¯ | 429 Too Many Requests | å»¶è¿Ÿåé‡è¯• |

### 6.2 æ–­ç‚¹ç»­ä¼ æœºåˆ¶

```typescript
// è‡ªåŠ¨ä¿å­˜çŠ¶æ€
private async saveState(scriptId: string, projectId: string, state: ScriptParseState): Promise<void> {
  await storageService.updateScriptParseState(scriptId, projectId, () => state);
}

// æ¢å¤çŠ¶æ€
private async loadState(scriptId: string, projectId: string): Promise<ScriptParseState | null> {
  const script = await storageService.getScript(scriptId, projectId);
  return script?.parseState || null;
}

// ä¸»æµç¨‹è‡ªåŠ¨æ¢å¤
async parseScript(scriptId: string, ...): Promise<ScriptParseState> {
  // å°è¯•æ¢å¤ä¹‹å‰çš„çŠ¶æ€
  const savedState = await this.loadState(scriptId, projectId);
  if (savedState && savedState.stage !== 'completed') {
    state = savedState;  // ä»æ–­ç‚¹ç»§ç»­
    onProgress?.(state.stage, state.progress, `ä» ${state.stage} é˜¶æ®µæ¢å¤...`);
  }
  // ...ç»§ç»­è§£æ
}
```

---

## ä¸ƒã€æ€§èƒ½ä¼˜åŒ–

### 7.1 æ‰¹é‡å¤„ç†
- **å•è§’è‰²/åœºæ™¯æ¨¡å¼**: Nä¸ªè§’è‰² = Næ¬¡APIè°ƒç”¨
- **æ‰¹é‡æ¨¡å¼**: Nä¸ªè§’è‰² = 1æ¬¡APIè°ƒç”¨ (æ¨è)

### 7.2 æ–‡æœ¬åˆ†å—
```typescript
private chunkText(text: string, maxChunkSize: number = 6000): string[] {
  const chunks: string[] = [];
  const paragraphs = text.split('\n\n');
  let currentChunk = '';

  for (const para of paragraphs) {
    if (currentChunk.length + para.length > maxChunkSize && currentChunk.length > 0) {
      chunks.push(currentChunk.trim());
      currentChunk = para;
    } else {
      currentChunk += (currentChunk ? '\n\n' : '') + para;
    }
  }

  if (currentChunk.trim()) {
    chunks.push(currentChunk.trim());
  }

  return chunks;
}
```

### 7.3 æ™ºèƒ½ç¼“å­˜
- åŸºäºå†…å®¹å“ˆå¸Œçš„LRUç¼“å­˜
- 1å°æ—¶TTLè‡ªåŠ¨è¿‡æœŸ
- æœ€å¤§100æ¡ç¼“å­˜

---

## å…«ã€æ‰©å±•åŠŸèƒ½è§„åˆ’

### 8.1 åˆ†å±‚ä¸Šä¸‹æ–‡å¢å¼º (è®¡åˆ’ä¸­)

```typescript
// æ–°å¢å…¨å±€ä¸Šä¸‹æ–‡æå–
interface ScriptContext {
  summary: string;        // æ•…äº‹æ¢—æ¦‚ï¼ˆ300-500å­—ï¼‰
  worldSetting: string;   // ä¸–ç•Œè§‚/æ—¶ä»£èƒŒæ™¯ï¼ˆ100å­—ï¼‰
  visualStyle: string;    // æ•´ä½“è§†è§‰é£æ ¼ï¼ˆ50å­—ï¼‰
  keyEvents: string[];    // å…³é”®äº‹ä»¶æ—¶é—´çº¿ï¼ˆ5-10æ¡ï¼‰
}

// ä¿®æ”¹åçš„Promptæ¨¡æ¿
const PROMPTS.characterWithContext = `
è¯·åŸºäºä»¥ä¸‹ä¿¡æ¯ï¼Œåˆ†æè§’è‰²"{characterName}"ã€‚

ã€æ•…äº‹èƒŒæ™¯ã€‘
{context}

ã€è§’è‰²ç›¸å…³æ®µè½ã€‘
{content}

é‡è¦æç¤ºï¼š
1. ç»“åˆæ•…äº‹èƒŒæ™¯ç†è§£è§’è‰²æœé¥°ã€èº«ä»½çš„è±¡å¾æ„ä¹‰
2. å‚è€ƒå…³é”®äº‹ä»¶æ—¶é—´çº¿ï¼Œåˆ¤æ–­è§’è‰²å½“å‰æ—¶æœŸçš„çŠ¶æ€
3. ä¾æ®è§†è§‰é£æ ¼ï¼Œä¿æŒæè¿°çš„ä¸€è‡´æ€§
`;
```

### 8.2 åŠŸèƒ½å¼€å…³
```typescript
const CONFIG = {
  enableContextEnhancement: true,  // ä¸Šä¸‹æ–‡å¢å¼º
  enableBatchMode: true,           // æ‰¹é‡æ¨¡å¼
  enableCache: true,               // ç¼“å­˜æœºåˆ¶
  enableAutoRetry: true,           // è‡ªåŠ¨é‡è¯•
};
```

---

## ä¹ã€APIé…ç½®è¦æ±‚

### 9.1 æ”¯æŒçš„LLMæ¨¡å‹

| ä¾›åº”å•† | æ¨¡å‹ç¤ºä¾‹ | é…ç½®è¦æ±‚ |
|-------|---------|---------|
| DeepSeek | deepseek-chat | API Key + API URL |
| Moonshot (Kimi) | moonshot-v1-8k | API Key + API URL |
| Alibaba (Qwen) | qwen-turbo | API Key + API URL |
| OpenAI | gpt-4o-mini | API Key |
| ModelScope | å„å¼€æºæ¨¡å‹ | API Key + API URL |

### 9.2 æ¨¡å‹é…ç½®å‚æ•°
```typescript
interface ModelConfig {
  id: string;
  name: string;
  provider: string;
  modelId: string;
  type: 'llm';
  apiKey: string;
  apiUrl?: string;
  parameters: [
    { name: 'temperature', defaultValue: 0.3 },
    { name: 'maxTokens', defaultValue: 4000 }
  ];
  capabilities: {
    maxContextLength: number;
    supportsJsonMode: boolean;
  };
}
```

---

## åã€æ€»ç»“

### 10.1 æ ¸å¿ƒæµç¨‹å›é¡¾

1. **ä¸Šä¼ å‰§æœ¬** â†’ åˆ›å»ºScriptå¯¹è±¡ï¼Œä¿å­˜åŸå§‹å†…å®¹
2. **æå–å…ƒæ•°æ®** â†’ è·å–æ ‡é¢˜ã€è§’è‰²åˆ—è¡¨ã€åœºæ™¯åˆ—è¡¨ç­‰åŸºç¡€ä¿¡æ¯
3. **åˆ†æè§’è‰²** â†’ æå–æ¯ä¸ªè§’è‰²çš„å¤–è²Œã€æ€§æ ¼ã€å…³ç³»ã€visualPrompt
4. **åˆ†æåœºæ™¯** â†’ æå–æ¯ä¸ªåœºæ™¯çš„ç¯å¢ƒã€æ°›å›´ã€åŠŸèƒ½ã€visualPrompt
5. **æå–é“å…·** â†’ è¯†åˆ«é‡è¦é“å…·/ç‰©å“
6. **ç”Ÿæˆåˆ†é•œ** â†’ ä¸ºæ¯ä¸ªåœºæ™¯ç”Ÿæˆè¯¦ç»†çš„æ‹æ‘„è„šæœ¬

### 10.2 æ•°æ®æµå‘

```
å°è¯´æ–‡æœ¬ 
    â†“
ScriptParser (LLMåˆ†æ)
    â†“
ScriptParseState (ç»“æ„åŒ–æ•°æ®)
    â†“
CharacterMapping/SceneMapping (èµ„äº§æ˜ å°„)
    â†“
CharacterAsset/SceneAsset (é¡¹ç›®èµ„äº§)
    â†“
ImageGeneration (AIç”Ÿå›¾)
```

### 10.3 å…³é”®è®¾è®¡åŸåˆ™

1. **æ¸è¿›å¼è§£æ**: æ”¯æŒåˆ†æ­¥éª¤è§£æï¼Œå¯éšæ—¶ä¸­æ–­å’Œæ¢å¤
2. **æ‰¹é‡ä¼˜åŒ–**: å‡å°‘APIè°ƒç”¨æ¬¡æ•°ï¼Œé™ä½æˆæœ¬
3. **å®¹é”™è®¾è®¡**: è‡ªåŠ¨é‡è¯•ã€é”™è¯¯æ¢å¤ã€é»˜è®¤å€¼å¡«å……
4. **ç¼“å­˜æœºåˆ¶**: é¿å…é‡å¤è§£æï¼Œæå‡æ€§èƒ½
5. **èµ„äº§æ˜ å°„**: è§£æç»“æœä¸é¡¹ç›®èµ„äº§çµæ´»å…³è”

---

**æ–‡æ¡£ç»“æŸ**
